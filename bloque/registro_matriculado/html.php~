<?
/*
############################################################################
#    UNIVERSIDAD DISTRITAL Francisco Jose de Caldas                        #
#    GRUPO DE INVESTIGACION EN TELEMEDICINA                                #
#    Directora General:                                                    #
#    Dra LILIA EDITH APARICIO P.                                           #
#    Copyright: Vea el archivo LICENCIA.txt que viene con la distribucion  #
############################################################################
*/
/***************************************************************************
  
html.php 

Paulo Cesar Coronado
Copyright (C) 2001-2005

Última revisión 6 de Marzo de 2006

*****************************************************************************
* @subpackage   
* @package	bloques
* @copyright    
* @version      0.2
* @author      	Paulo Cesar Coronado
* @link		N/D
* @description  Formulario de registro de medicamentoes
* @usage        Toda pagina tiene un id_pagina que es propagado por cualquier metodo GET, POST.
*******************************************************************************/
if(!isset($GLOBALS["autorizado"]))
{
	include("../index.php");
	exit;		
}


$conexion=new dbConexion($configuracion);
$acceso_db=$conexion->recursodb($configuracion,"oracle1");
$enlace=$acceso_db->conectar_db();

if($enlace)
{
	$mtime = microtime();
	$mtime = explode(" ",$mtime);
	$mtime = $mtime[1] + $mtime[0];
	$tiempoinicial = $mtime;

	include ($configuracion["raiz_documento"].$configuracion["estilo"]."/".$this->estilo."/tema.php");
	$el_estilo=$this->estilo;
	$formulario="registro_componente";
	$verificar="control_vacio(".$formulario.",'codigo')";
	
	if(isset($_REQUEST['opcion']))
	{
		$accion=$_REQUEST['opcion'];
		
		if($accion=="mostrar")
		{
			
			if(isset($_REQUEST['id_elemento']))
			{
				mostrar_registro_componente($configuracion,$tema,$_REQUEST['id_elemento']);
			}
		}
		else
		{
			
			if($accion=="nuevo")
			{
				nuevo_registro_componente($configuracion,$tema,$accion,$formulario,$verificar,$fila,$tab,$el_estilo);
			
			}
			else
			{
				if($accion=="editar")
				{
					editar_registro_componente($configuracion,$tema,$accion,$formulario,$verificar,$fila,$tab,$el_estilo);
				
				}
				else
				{
					if($accion=="corregir")
					{
						corregir_registro_componente($configuracion,$tema,$accion,$formulario,$verificar,$fila,$tab);
					
					}
				}		
			}
			
		
		}
	}
	else
	{
		$accion="nuevo";
		editar_registro_componente($configuracion,$acceso_db);
	}
	
	$mtime = microtime();
	$mtime = explode(" ",$mtime);
	$mtime = $mtime[1] + $mtime[0];
	$tiempofinal = $mtime;
	$tiempototal = ($tiempofinal - $tiempoinicial);
	echo "La página fue creada en ".$tiempototal." segundos en servidor nuevo<br>"; 

}
/****************************************************************************************
*				Funciones						*
****************************************************************************************/
/*
function nuevo_registro_componente($configuracion,$tema,$accion,$formulario,$verificar,$fila,$tab,$estilo)
{

	include_once($configuracion["raiz_documento"].$configuracion["clases"]."/encriptar.class.php");
	$cripto=new encriptar();
	$datos="";
	$contador=0;
?><form enctype='multipart/form-data' method="post" action="index.php" name="<? echo $formulario?>" onsubmit="return(<? echo $verificar ?>)?submit():false;">
<table width="100%" cellpadding="12" cellspacing="0"  align="center">
	<tbody>
		<tr>
			<td align="center" valign="middle">
				<table class='bloquelateral' align='center' width='100%' cellpadding='0' cellspacing='0'>
					<tr>
					<td>
					<table align='center' width='100%' cellpadding='7' cellspacing='1'>
						<tr class="bloquecentralencabezado">
							<td colspan="2" rowspan="1">::.. Registro para Nuevo Medicamento</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td bgcolor='<? echo $tema->celda ?>'>
								<a href="http://es.wikipedia.org/wiki/código_ATC" target="_new">C&oacute;digo ATC</a>:
							</td>
							<td bgcolor='<? echo $tema->celda ?>'>
								<input type='text' name='atc' size='30' maxlength='255' tabindex='<? echo $tab++ ?>' >
							</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td bgcolor='<? echo $tema->celda ?>'>
								Denominaci&oacute;n:
							</td>
							<td bgcolor='<? echo $tema->celda ?>'>
								<input type='text' name='denominacion' size='35' maxlength='255' tabindex='<? echo $tab++ ?>' >
							</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td bgcolor='<? echo $tema->celda ?>'>
								Grupo Terape&uacute;tico:
							</td>
							<td bgcolor='<? echo $tema->celda ?>'>
								<input type='text' name='grupo' size='35' maxlength='255' tabindex='<? echo $tab++ ?>' >
							</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td bgcolor='<? echo $tema->celda ?>'>
								Principio Activo :
							</td>
							<td bgcolor='<? echo $tema->celda ?>'>
								<input type='text' name='principio' size='35' maxlength='255' tabindex='<? echo $tab++ ?>' >
							</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td colspan="2" bgcolor='<? echo $tema->celda ?>'>
								<span class="texto_negrita">Indicaci&oacute;n Terape&uacute;tica:</span>
							</td>
						</tr>		
						<tr class='bloquecentralcuerpo'>
							<td colspan="2" align="center">
								<textarea id='indicacion' name='indicacion' cols='50' rows='2' tabindex='<? echo $tab++ ?>' ></textarea>
								<script type="text/javascript">
									mis_botones='<? echo $configuracion["host"].$configuracion["site"].$configuracion["grafico"]?>/';
									archivo_css='<? echo $configuracion["host"].$configuracion["site"].$configuracion["estilo"]."/".$estilo."/estilo.php" ?>';
									editor_html('indicacion', 'bold italic underline | left center right | number bullet | wikilink');
								</script>
							</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td colspan="2" bgcolor='<? echo $tema->celda ?>'>
								<span class="texto_negrita">Contraindicaciones:</span>
							</td>
						</tr>		
						<tr class='bloquecentralcuerpo'>
							<td colspan="2" align="center">
								<textarea id='contraindicacion' name='contraindicacion' cols='50' rows='2' tabindex='<? echo $tab++ ?>' ></textarea>
								<script type="text/javascript">
									mis_botones='<? echo $configuracion["host"].$configuracion["site"].$configuracion["grafico"]?>/';
									archivo_css='<? echo $configuracion["host"].$configuracion["site"].$configuracion["estilo"]."/".$estilo."/estilo.php" ?>';
									editor_html('contraindicacion', 'bold italic underline | left center right | number bullet | wikilink');
								</script>
							</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td colspan="2" bgcolor='<? echo $tema->celda ?>'>
								<span class="texto_negrita"><a href="http://www.wordreference.com/definicion/concomitancia" target="_new">Concomitancia</a>:</span>
							</td>
						</tr>	
						<tr class='bloquecentralcuerpo'>
							<td colspan="2" align="center">
								<textarea id='concomitancia' name='concomitancia' cols='50' rows='2' tabindex='<? echo $tab++ ?>' ></textarea>
								<script type="text/javascript">
									mis_botones='<? echo $configuracion["host"].$configuracion["site"].$configuracion["grafico"]?>/';
									archivo_css='<? echo $configuracion["host"].$configuracion["site"].$configuracion["estilo"]."/".$estilo."/estilo.php" ?>';
									editor_html('concomitancia', 'bold italic underline | left center right | number bullet | wikilink');
								</script>
							</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td colspan="2" bgcolor='<? echo $tema->celda ?>'>
								<span class="texto_negrita">Reacciones Adversas:</span>
							</td>
						</tr>	
						<tr class='bloquecentralcuerpo'>
							<td colspan="2" align="center">
								<textarea id='reaccion' name='reaccion' cols='50' rows='2' tabindex='<? echo $tab++ ?>' ></textarea>
								<script type="text/javascript">
									mis_botones='<? echo $configuracion["host"].$configuracion["site"].$configuracion["grafico"]?>/';
									archivo_css='<? echo $configuracion["host"].$configuracion["site"].$configuracion["estilo"]."/".$estilo."/estilo.php" ?>';
									editor_html('reaccion', 'bold italic underline | left center right | number bullet | wikilink');
								</script>
							</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td colspan="2" bgcolor='<? echo $tema->celda ?>'>
								<span class="texto_negrita">Precauciones:</span>
							</td>
						</tr>	
						<tr class='bloquecentralcuerpo'>
							<td colspan="2" align="center">
								<textarea id='precaucion' name='precaucion' cols='50' rows='2' tabindex='<? echo $tab++ ?>' ></textarea>
								<script type="text/javascript">
									mis_botones='<? echo $configuracion["host"].$configuracion["site"].$configuracion["grafico"]?>/';
									archivo_css='<? echo $configuracion["host"].$configuracion["site"].$configuracion["estilo"]."/".$estilo."/estilo.php" ?>';
									editor_html('precaucion', 'bold italic underline | left center right | number bullet | wikilink');
								</script>
							</td>
						</tr>
						<tr class='bloquecentralcuerpo' <? echo efecto_fila($contador++,$tema); ?>>
							<td bgcolor='<? echo $tema->celda ?>'>
								Imagen Descriptiva:
							</td>
							<td bgcolor='<? echo $tema->celda ?>'>
								<input type='file' name='imagen' tabindex='<? echo $tab++ ?>' >
							</td>
						</tr>		
						<tr align="center" class="bloquecentralcuerpo">
							<td align="center"><?
							$datos.="&action=registro_componente";						
							$datos=$cripto->codificar($datos,$configuracion);	
							?>	<input type='hidden' name='formulario' value="<? echo $datos ?>">
								<input value="Enviar" name="aceptar" tabindex='<? echo $tab++ ?>' type="submit"><br>								
							</td>
							<td align="center">
								<input name='cancelar' value='Cancelar' type='submit'><br>
							</td>
						</tr>
					</table>
					</td>
					</tr>
				</table>
			</td>
		</tr>
	</tbody>
</table>
</form>
<?
}*/


function editar_registro_componente($configuracion,$acceso_db)
{
	
		$cadena_sql="select distinct 1301 IES_CODE,car_doc_nro_iden CODIGO_UNICO,04 NIVEL_EST_CODE,'CC' TIPO_DOC_UNICO,b.doc_fecha_desde FECHA_INGRESO from mntac.accarga, mntac.acdocente b where car_ape_ano=2008 and car_ape_per=1 "; 
		$acceso_db->registro_db($cadena_sql,0);
		$registro=$acceso_db->obtener_registro_db();
		$campos=$acceso_db->obtener_conteo_db();
		if($campos>0)
		{
			include_once($configuracion["raiz_documento"].$configuracion["clases"]."/encriptar.class.php");
			$cripto=new encriptar();
			$indice=$configuracion["host"].$configuracion["site"]."/index.php?";
			?><form method="post" action="index.php" name="activar_usuario">
<table width="100%" align="center" border="0" cellpadding="10" cellspacing="0" >
	<tbody>
		<tr>
			<td >
				<table width="100%" border="0" align="center" cellpadding="5 px" cellspacing="1 px" class="bloquelateral">
					<tr align="center" class="bloquecentralencabezado">
						<td >C&oacute;digo</td>
						<? //<td>Correo</td> ?>
						<td>Nombre</td>
						<td>ICFES</td>
						<td colspan="2">Opciones</td>
					</tr>
						<?
	for($contador=0;$contador<$campos;$contador++)
	{
								?>
					<?/*Campo oculto con el id_usuario para poder realizar la actualización de la información*/?>							
					<tr class="bloquecentralcuerpo" onmouseover="setPointer(this, <? echo $contador ?>, 'over', '<? echo $tema->celda ?>', '<? echo $tema->apuntado ?>', '<? echo $tema->seleccionado ?>');" onmouseout="setPointer(this, <? echo $contador ?>, 'out', '<? echo $tema->celda ?>', '<? echo $tema->apuntado ?>', '<? echo $tema->seleccionado ?>');" onmousedown="setPointer(this, <? echo $contador ?>, 'click', '<? echo $tema->celda ?>', '<? echo $tema->apuntado ?>', '<? echo $tema->seleccionado ?>');">
						<td bgcolor="<? echo $tema->celda ?>"><? echo $registro[$contador][0] ?>
						<input type="hidden" name= "usuario<? echo $contador ?>" value="<?echo $registro[$contador][3] ?>">
						<input type="hidden" name= "subsistema<? echo $contador ?>" value="<?echo $registro[$contador][5] ?>">
						<input type="hidden" name= "hoja" value="<?echo $_REQUEST["hoja"] ?>">
						<input type="hidden" name= "accion" value="<?echo $_REQUEST["accion"] ?>">
						<?/*Campos ocultos para dar continuidad al formulario actual*/?>
						<input type="hidden" name= "nombre<? echo $contador ?>" value="<?echo $registro[$contador][6] ?>">
						</td>
						<? /*<td class="celdatabla"><? echo $registro[$contador][2] ?></td>*/?>
						<td bgcolor="<? echo $tema->celda ?>"><? echo $registro[$contador][1] ?></td>
						<td align="center" bgcolor="<? echo $tema->celda ?>"><? echo $registro[$contador][4] ?></td>
						<td align="center" bgcolor="<? echo $tema->celda ?>">
						<a href="<?
									$variable="pagina=registro_admin_usuario";
									$variable.="&opcion=editar";
									$variable.="&id_usuario=".$registro[$contador][3];
									$variable.="&hoja=".$_REQUEST["hoja"];
									$variable.="&accion=".$_REQUEST["accion"];
									$variable.="&mostrar=".$_REQUEST["mostrar"];
									$variable=$cripto->codificar_url($variable,$configuracion);
									echo $indice.$variable;	
						?>"><img width="24" height="24" src="<? echo $configuracion["host"].$configuracion["site"].$configuracion["grafico"]?>/boton_editar.png" alt="Editar Usuario" title="Editar Usuario" border="0" /></a>
						</td>
						<td align="center" bgcolor="<? echo $tema->celda ?>">
						<a href="<?
									$variable="pagina=borrar_usuario";
									$variable.="&opcion=usuario";
									$variable.="&id_usuario=".$registro[$contador][3];
									$variable.="&subsistema=".$registro[$contador][5];
									$variable.="&hoja=".$_REQUEST["hoja"];
									$variable.="&accion=".$_REQUEST["accion"];
									$variable.="&mostrar=".$_REQUEST["mostrar"];
									$variable=$cripto->codificar_url($variable,$configuracion);
									echo $indice.$variable;	
						?>"><img width="24" height="24" src="<? echo $configuracion["host"].$configuracion["site"].$configuracion["grafico"]?>/boton_borrar.png" alt="Borrar usuario del sistema" title="Borrar usuario del sistema" border="0" /></A>
						</td>	
					</tr><?
	}
	?>				<tr>
					<td style="text-align: center;" colspan="6" rowspan="1">
					<input type="hidden" name="action" value="admin_usuario">
					<input value="aceptar" name="aceptar" type="submit"> </td>
					</tr>
				</table>
			</td>
		</tr>
	</tbody>
</table>
				
				
				<br>
</form><?
		}
		else
		{
			//echo "Imposible mostrar los datos";
		
		}
}


function mostrar_registro_componente($configuracion,$tema,$id_componente)
{
	$acceso_db=new dbms($configuracion);
	$enlace=$acceso_db->conectar_db();
	if (is_resource($enlace))
	{
		$cadena_sql="SELECT ";
		$cadena_sql.="`id_c_organizacion`, ";
		$cadena_sql.="`id_usuario`, ";
		$cadena_sql.="`fecha`, ";
		$cadena_sql.="`nombre`, ";
		$cadena_sql.="`etiqueta`, ";
		$cadena_sql.="`web`, ";
		$cadena_sql.="`correo`, ";
		$cadena_sql.="`mision`, ";
		$cadena_sql.="`vision`, ";
		$cadena_sql.="`descripcion`, ";
		$cadena_sql.="`comentario` ";
		$cadena_sql.="FROM ";
		$cadena_sql.=$configuracion["prefijo"]."c_organizacion "; 
		$cadena_sql.="WHERE ";
		$cadena_sql.="`id_c_organizacion`=".$id_componente." ";
		$cadena_sql.="LIMIT 1 ";
		
		$campos=$acceso_db->registro_db($cadena_sql,0);
		$registro=$acceso_db->obtener_registro_db();		
		if($campos>0)
		{			
?><table class='bloquelateral' align='center' width='100%' cellpadding='0' cellspacing='0'>
	<tr>
		<td>
			<table class='bloquecentralcuerpo' align='center' width='100%' cellpadding='7' cellspacing='1'>
				<tr>
					<td align="center" colspan="2">
					<br>
					</td>							
				</tr>
				<?
				if(strlen($registro[0][3])>3)
				{			
			?>	<tr class='texto_titulo'>
					<td colspan="2">
						<? echo htmlentities($registro[0][3], ENT_COMPAT, "ISO-8859-1") ?><hr class="hr_subtitulo" />
					</td>
				</tr><?
				}
			
				if(strlen($registro[0][9])>3)
				{			
			?>	<tr class='bloquecentralcuerpo'>
					<td colspan="2">
						<? echo htmlentities($registro[0][9], ENT_COMPAT, "ISO-8859-1")  ?>
					</td>
				</tr><?
				}
			?>
			<tr class='texto_subtitulo'>
					<td colspan="2">
						Datos de Contacto<hr class="hr_subtitulo" />
					</td>
			</tr>				
			<tr class='bloquecentralcuerpo'>
				<td colspan="2">
					<table class='tabla_basico'>
						<tr class='bloquecentralcuerpo' >
							<td> P&aacute;gina Web: <?
						if(strlen($registro[0][5])>3)
						{			
							echo htmlentities($registro[0][5], ENT_COMPAT, "ISO-8859-1") ;
						}
						else
						{
							echo "No especificada";
						
						}
					?>		<br></td>
						</tr>
						<tr class='bloquecentralcuerpo' >
							<td> Correo Electr&oacute;nico: <?
						if(strlen($registro[0][6])>3)
						{			
							echo htmlentities($registro[0][6], ENT_COMPAT, "ISO-8859-1") ;
						}
						else
						{
							echo "No especificado";
						
						}
					?>		<br></td>
						</tr>
					</table>
				</td>
			</tr>
			<tr class='texto_subtitulo'>
					<td colspan="2">
						Misi&oacute;n<hr class="hr_subtitulo" />
					</td>
			</tr>
			<tr class='bloquecentralcuerpo'>
				<td colspan="2">
					<table class='tabla_alerta'>
						<tr class='bloquecentralcuerpo' >
							<td><?
						if(strlen($registro[0][7])>3)
						{			
							echo htmlentities($registro[0][7], ENT_COMPAT, "ISO-8859-1") ;
						}
						else
						{
							echo "La unidad organizacional no ha declarado una misi&oacute;n.";
						
						}
					?>		<br></td>
						</tr>
					</table>
				</td>
			</tr>
			<tr class='texto_subtitulo'>
					<td colspan="2">
						Visi&oacute;n<hr class="hr_subtitulo" />
					</td>
			</tr>
			<tr class='bloquecentralcuerpo'>
				<td colspan="2">
					<table class='tabla_alerta'>
						<tr class='bloquecentralcuerpo' >
							<td><?
						if(strlen($registro[0][8])>3)
						{			
							echo htmlentities($registro[0][8], ENT_COMPAT, "ISO-8859-1") ;
						}
						else
						{
							echo "La unidad organizacional no ha declarado una misi&oacute;n.";
						
						}
					?>		<br></td>
						</tr>
					</table>
				</td>
			</tr>
			</table>
		</td>
	</tr>
</table>

<?		}
		else
		{
			echo "Existe una incompatibilidad en el registro. Por favor consulte con el administrador del sistema.";
		}
	}
}

function efecto_fila($contador,$tema)
{
	
	$cadena_efecto="onmouseover=\"";
	$cadena_efecto.="setPointer(this, ".$contador.", 'over', '".$tema->celda."', '".$tema->apuntado."', '".$tema->seleccionado."');\"";
	$cadena_efecto.="onmouseout=\"";
	$cadena_efecto.="setPointer(this, ".$contador.", 'out', '".$tema->celda."', '".$tema->apuntado."', '".$tema->seleccionado."');\"";
	$cadena_efecto.="onmousedown=\"";
	$cadena_efecto.="setPointer(this, ".$contador.", 'click', '".$tema->celda."', '".$tema->apuntado."', '".$tema->seleccionado."');\"";
	return $cadena_efecto;
}
?>
